# 修改系统权限控制逻辑

## 目标

将部分需要管理员身份认证才能执行的POST和PUT请求方法，调整为仅需已登录账号即可操作的权限级别。

## 实现步骤

1. **创建新的认证中间件**

   * 在 `lib/auth.ts` 中添加 `requireLoggedInUser` 中间件，该中间件只要求用户已登录，不需要管理员权限

   * 该中间件将验证用户身份，但不检查是否为管理员

2. **更新权限验证中间件**

   * 修改 `requireAuth` 中间件，使其继续保持管理员权限要求

   * 确保 `requireWebsiteAuth` 中间件保持不变

3. **调整API端点权限**

   * 检查所有使用 `isAuthorizedAdmin` 或 `requireAuth` 的API端点

   * 将其中的POST和PUT请求的权限检查从管理员权限调整为仅需登录权限

   * 确保所有GET请求的权限检查保持不变

   * 重点关注以下端点：

     * `/api/activation-codes` 相关端点

     * `/api/websites` 相关端点

     * `/app/software` 相关端点

     * 其他使用了管理员权限的POST/PUT请求

4. **测试验证**

   * 确保所有GET请求仍能正常访问

   * 确保已登录用户可以访问调整后的POST/PUT请求

   * 确保未登录用户无法访问受保护的请求

   * 确保管理员用户仍能访问所有请求

## 预期结果

* 部分POST和PUT请求将允许所有已登录用户访问

* 所有GET请求的权限保持不变

* 系统的安全性和稳定性不受影响

* 权限变更将正确应用到指定的API端点

* 删除管理员用户逻辑以及相关代码

  <br />

